---
title: "R Notebook"
output: html_notebook
---





#Comparing two maps in GUI and code-based environments


The idea behind these studies comes to produce two maps using the POLICE.UK street-crimes data (https://data.police.uk/). The first spatial representation consists in a spatial relation between street crimes and the Underground Station locations, the second takes into consideration the street-crimes harm index whitin the City of London perimeter. 

For this purpose the “Police.uk” web-site provides a large quantity of data in CSV format with x,y geographic coordinates. Particularly in this case, the London Metropolitan Police service was used to download the csv file which is released monthly, the latest record is August 2018. According to the methodology chose by authors, the file describes “individual crime and anti-social behaviour (ASB) incidents, including street-level location information and subsequent police and court ourcomes associated with crimes”(https://data.police.uk/about/#columns). Along with the Police data, other Open Street Map shapefiles were downloaded from the related Geofabrik website (https://download.geofabrik.de/) as of 1st October 2018 and used as cartographic background for the overall process.


##Visualizing The London Metropolitan Police street-crimes data compared to the Underground Stations location as August 2018. 


The first map is produced using the QGIS GUI based-approach importing the Metropolitan Police cvs table and transforming it into points shapefile (point_crime.shp). A first visulisation of the new shapefile was created with style>simbology>Heatmap, this compute in QGIS enfasizes the street-crime concetration around the Soho area. 

![](\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataInput\\data crime London\\London_BoroughsOverall2.PNG)


As a matter of deeper analysis, the focus area for the spatial relation beetween crimes and underground stations is based on the Westminister Borough, which is the most afected in the whole London area. 
The next step uses the hub line analysis,after dowlonading the MMQGIS plug-in.This procedure has been inspired by the QGIS tutorial at the following web-page: (https://www.qgistutorials.com/en/docs/nearest_neighbor_analysis.html).

A brand new table has been created through the distance matrix analysis (Vector>Analysis Tools>Distance Matrix).As input parameter has been used the Westminiter crimes record and as target points, the underground stations. The matrix is joined with the Westminster crime records, saved as new file and performed as Hub point layer with MMQGIS>Create>Hub Lines.
The maps shows the connections that London stations have due their proximity to crime records, according to the Linear(N*k x 3) previously used during the matrix creation. 


## Vizualising the street-crime harm index

The second map is using ther code-based environment in RStudio and takes into consideration the City of London police street-crime records during August 2018.

Inserting the two csv files:

```{r}


library(tidyverse)
library(sf)
library(sp)
library(raster)
library(maptools)
library(RColorBrewer)
library(classInt)
library(OpenStreetMap)
library(rgeos)
library(tmap)
library(tmaptools)
library(sf)
library(rgdal)
library(geojsonio)
library(ggplot2)

SC08_18 <- read.csv("C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataInput\\data crime London\\278f379b19290400f4123e740fc18bae2bc00ae4\\2018-08\\2018-08-city-of-london-street.csv", header=TRUE, sep = ",")


names(SC08_18)


class(SC08_18)
class(COL_buldings)


str(SC08_18)
plot(SC08_18$Crime.type)




```


##PLace the CRS to the 2 tables:

```{r}
##taking the reference from: http://www.spatialreference.org/ref/epsg/32622/
 
# convert the dataframes to  objects:

SC08_18_sp <- st_as_sf(SC08_18, coords= c("Longitude", "Latitude"), crs= "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
+towgs84=0,0,0")


crs(SC08_18_sp)

```


##Convert the csv in points shapefile:
```{r}

#EXport the obejcts as shapefiles:


st_write(SC08_18_sp,"C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataOutput\\Crimes08_18.shp", driver="ESRI shapefile")


```
 
 
 
## Import the base shapefile(buildings) and the street-crime points:
 
```{r}

Points_Crime_08<-readOGR("C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataOutput\\Crimes08_18.shp")


CoL_area<- readOGR("C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataOutput\\CoL_area.shp")

crs(SC08_18_sp)
crs(CoL_area)

```


##"Coloring the Crime"
```{r}

print(Points_Crime)
print(CoL_area)
levels(Points_Crime_08$Crime.type)
levels(CoL_area$name)

osm_base<- read_osm(Points_Crime_08, upperLeft type="esri", zoom=NULL)
qtm(osm_base)+
tmap_mode("view")+
  tm_shape (CoL_area)+
  tm_polygons("code",
              alpha = 0)+
  tm_shape(Points_Crime_08)+
  tm_dots("Harm.Index",
          alpha=0.6,
          border.alpha=0,
          shape = 5,
          style="jenks",
          palette="YlOrRd",
          midpoint=NA,
          title = "Crime harm index")


```



##transforming into sf for ggplot
```{r}
Points_Crime_08_sf<-st_as_sf(Points_Crime_08)
COL_buldings_sf<-st_as_sf(COL_buldings)

ggplot()+
  geom_sf(data=COL_buldings_sf, color="brown")+
  geom_sf(data=Points_Crime_08_sf,
          shape=20, 
          style="jenks",
          palette="YlOrRd",
          show.legend = "line", 
          size=1)+
  ggtitle("Coloring street-crime")+
  coord_sf()

```






