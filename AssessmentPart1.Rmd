---
title: "R Notebook"
output: html_notebook
---





#Comparing two maps in GUI and code-based environments


The idea behind these studies comes to produce two maps using the POLICE.UK street-crimes data (https://data.police.uk/). The first spatial representation consists in comparing the street crimes and the Underground Stations location, the second takes into consideration the difference of street-crimes in two different months in the City of London area. 

For this purpose the “Police.uk” web-site provides a large quantity of data in CSV format with x,y coordinates . Particularly in this case, the London Metropolitan Police service was used to download the csv file which is released monthly from September 2015 to August 2018. According to the methodology chose by authors, the file describes “individual crime and anti-social behaviour (ASB) incidents, including street-level location information and subsequent police and court”(https://data.police.uk/about/#columns). Along with the Police data, other Open Street Map shapefiles were downloaded from the related Geofabrik website (https://download.geofabrik.de/) as of 1st October 2018 and used as cartographic base for the overall process.


##Visualizing The London Metropolitan Police street-crimes data compared to the Underground Stations location as August 2018. 


The first map is produced using the QGIS GUI based-approach adding different OSM shapefiles within the London area. After importing the Metropolitan Police cvs table and transforming it into points layer (point_crime),  a brand new table has been created through the distance matrix analysis (Vector>Analysis Tools>Distance Matrix). 
The new “Distance matrix.csv” then has been joined with the previous “point_crime.shp” file with properties>joins. This passage was required in order to create the hub line analysis (downloading the MMQGIS plug-in). 
The maps shows the connections that London stations have due their proximity to crime records, according to the Linear(N*k x 3) previously used during the matrix creation. 


## Vizualising the street-crime rate between 2015-2018

The second map is using ther code-based environment in RStudio and takes into consideration the City of London police street-crime records trend for the July-August 2018 period.

Inserting the two csv files:

```{r}


library(tidyverse)
library(sf)
library(sp)
library(raster)
library(maptools)
library(RColorBrewer)
library(classInt)
library(OpenStreetMap)
library(rgeos)
library(tmap)
library(tmaptools)
library(sf)
library(rgdal)
library(geojsonio)
library(ggplot2)

SC08_18 <- read.csv("C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataInput\\data crime London\\278f379b19290400f4123e740fc18bae2bc00ae4\\2018-08\\2018-08-city-of-london-street.csv", header=TRUE, sep = ",")


names(SC08_18)


class(SC08_18)
class(COL_buldings)


str(SC08_18)
plot(SC08_18$Harm.Index)




```


##PLace the CRS to the 2 tables:

```{r}
##taking the reference from: http://www.spatialreference.org/ref/epsg/32622/
 
# convert the dataframes to  objects:

SC08_18_sp <- st_as_sf(SC08_18, coords= c("Longitude", "Latitude"), crs= "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
+towgs84=0,0,0")


crs(SC08_18_sp)

```


##Convert the csv in points shapefile:
```{r}

#EXport the obejcts as shapefiles:


st_write(SC08_18_sp,"C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataOutput\\Crimes08_18.shp", driver="ESRI shapefile")


```
 
 
 
## Import the base shapefile(buildings) and the street-crime points:
 
```{r}

Points_Crime_08<-readOGR("C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataOutput\\Crimes08_18.shp")


COL_buldings<- readOGR("C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataOutput\\CLA_buildings.shp")

crs(SC08_18_sp)
crs(COL_buldings)

```


##"Coloring the Crime"
```{r}

print(Points_Crime)
print(COL_buldings)
levels(Points_Crime_08$Crime.type)

osm_base<- read_osm(Points_Crime_08, type="esri", zoom=NULL)
qtm(osm_base)+
# tmap_mode("view")+
  tm_shape (COL_buldings)+
  tm_polygons("type")+
  tm_shape(Points_Crime_08)+
  tm_dots("Crime.type",
          alpha=0.6,
          shape = 5,
          style="jenks",
          palette="YlOrBr",
          midpoint=NA,
          title = "Crime harm index\n - City of London")

##transforming into sf
Points_Crime_08_sf<-st_as_sf(Points_Crime_08)
COL_buldings_sf<-st_as_sf(COL_buldings)

ggplot()+
  geom_sf(data=COL_buldings_sf, fill="brown", color="brown")+
  geom_sf(data=Points_Crime_08_sf,shape=10, color="red",
          show.legend = "line", size=1)+
  ggtitle("Coloring street-crime")+
  coord_sf()




```


##Rasterizing the two tables

```{r}

pts <- read.csv("C:\\Users\\Bogdan\\Documents\\UCL\\MRes\\GIS\\week4\\AssessmentPart1\\DataInput\\data crime London\\278f379b19290400f4123e740fc18bae2bc00ae4\\2018-08\\2018-08-city-of-london-street.csv")
coordinates(pts) <- ~Longitude+Latitude
rast <- raster(ncol=10, nrow=10)
extent(rast) <- extent(pts)
rasterize(pts, rast,fun = mean)
pts


```
 



